#!/usr/bin/env perl
# Copyright [1999-2015] Wellcome Trust Sanger Institute and the EMBL-European Bioinformatics Institute
# Copyright [2016-2021] EMBL-European Bioinformatics Institute
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
use strict;
use warnings;

use Test::More;

use Bio::EnsEMBL::Test::TestUtils;
use Bio::EnsEMBL::Test::MultiTestDB;

use Bio::EnsEMBL::Hive::Utils::Test qw(standaloneJob);

use_ok('Bio::EnsEMBL::Analysis::Hive::RunnableDB::CleanUTRs');

my $multi = Bio::EnsEMBL::Test::MultiTestDB->new('pararge_aegeria');
my $iid = 'primary_assembly:ilParAegt1.1:1:1:21295481:1';
# Expected value should be 50 when ENSPAGG00005005368 is fixed
my $expected_total_gene_count = 51;
my $expected_total_transcript_count = 55;

my %transcript_hashkey = (
  ENSPAGT00005009094 => ':7555030:7555504:-1:-1:-1:7539772:7539921:-1:-1:1:7532631:7532860:-1:1:0:7530275:7530391:-1:0:0:7529714:7529920:-1:0:0:7524996:7525128:-1:0:1:7523477:7523706:-1:1:0:7522602:7522796:-1:0:0:7519669:7521417:-1:0:-1',
  ENSPAGT00005009105 => ':7555030:7555504:-1:-1:-1:7539772:7539921:-1:-1:1:7532631:7532860:-1:1:0:7530275:7530391:-1:0:0:7529714:7529920:-1:0:0:7524996:7525128:-1:0:1:7523477:7523706:-1:1:0:7522602:7522796:-1:0:0:7519669:7521417:-1:0:-1',
  ENSPAGT00005009363 => ':13648453:13649543:1:-1:0:13649717:13649939:1:0:1:13650123:13650342:1:1:2:13651022:13652888:1:2:-1',
  ENSPAGT00005009369 => ':13645738:13645907:1:-1:-1:13648453:13649543:1:-1:0:13649717:13649939:1:0:1:13650123:13650342:1:1:2:13651022:13652888:1:2:-1',
  ENSPAGT00005009377 => ':13648250:13648278:1:0:2:13648697:13649543:1:2:0:13649717:13649939:1:0:1:13650123:13650342:1:1:2:13651022:13651310:1:2:0',
  ENSPAGT00005009805 => ':15623672:15623869:-1:-1:-1:15623281:15623537:-1:0:2:15622662:15622840:-1:2:1:15621976:15622088:-1:1:0:15621162:15621323:-1:0:0:15616608:15616828:-1:0:-1',
  ENSPAGT00005009808 => ':15628654:15628936:-1:-1:0:15623281:15623537:-1:0:2:15622662:15622840:-1:2:1:15621976:15622088:-1:1:0:15620429:15621323:-1:0:-1',
  ENSPAGT00005009856 => ':10024083:10025182:-1:-1:1:10023164:10023415:-1:1:1:10022419:10023045:-1:1:1:10010726:10010911:-1:1:-1',
  ENSPAGT00005010431 => ':3633933:3634053:1:-1:0:3634262:3634349:1:0:1:3635169:3635269:1:1:0:3635958:3636155:1:0:-1',
  ENSPAGT00005010435 => ':3625315:3625433:1:-1:-1:3625984:3626065:1:-1:-1:3632765:3632931:1:-1:-1:3633933:3634053:1:-1:0:3634262:3634349:1:0:1:3635169:3635269:1:1:0:3635958:3636155:1:0:-1',
  ENSPAGT00005010440 => ':3625315:3625433:1:-1:-1:3632765:3632931:1:-1:-1:3633933:3634053:1:-1:0:3634262:3634349:1:0:1:3635169:3635269:1:1:0:3635958:3636155:1:0:-1',
  ENSPAGT00005010941 => ':9996681:9999302:-1:-1:-1',
  ENSPAGT00005010944 => ':9996681:9999302:-1:-1:-1',
  ENSPAGT00005010947 => ':9996681:9999302:-1:-1:-1',
  ENSPAGT00005010952 => ':9996681:9999302:-1:-1:-1',
  ENSPAGT00005010958 => ':9996681:9999302:-1:-1:-1',
  ENSPAGT00005010980 => ':3594096:3594216:1:-1:1:3598836:3598950:1:1:2:3599689:3599883:1:2:2:3600616:3600833:1:2:1:3611765:3611946:1:1:0:3613030:3613211:1:0:2:3614089:3614314:1:2:0:3614393:3614551:1:0:0:3614624:3615739:1:0:0:3615822:3617263:1:0:-1',
  ENSPAGT00005010995 => ':3597241:3597481:1:-1:1:3598836:3598950:1:1:2:3599689:3599883:1:2:2:3600616:3600833:1:2:1:3611765:3611946:1:1:0:3613030:3613211:1:0:2:3614089:3614314:1:2:0:3614393:3614551:1:0:0:3614624:3615739:1:0:0:3615822:3617263:1:0:-1',
  ENSPAGT00005011019 => ':3597241:3597481:1:-1:1:3598836:3598950:1:1:2:3599689:3599883:1:2:2:3600616:3600833:1:2:1:3611765:3611946:1:1:0:3613030:3613211:1:0:2:3614089:3614314:1:2:0:3614393:3614551:1:0:0:3614624:3615739:1:0:0:3615822:3616082:1:0:0:3616151:3617263:1:0:-1',
  ENSPAGT00005011035 => ':3597241:3597481:1:-1:1:3598836:3598950:1:1:2:3599689:3599883:1:2:2:3600616:3600833:1:2:1:3611765:3611946:1:1:0:3613030:3613211:1:0:2:3614089:3614314:1:2:0:3614393:3614551:1:0:0:3614624:3614698:1:0:0:3615660:3615739:1:0:-1',
  ENSPAGT00005011166 => ':10005635:10006470:-1:0:2:10004907:10004928:-1:2:0',
  ENSPAGT00005011173 => ':10006507:10007158:-1:-1:1:10005321:10006145:-1:1:-1',
  ENSPAGT00005011597 => ':7754744:7754857:-1:-1:-1:7753278:7753492:-1:-1:1:7752773:7752881:-1:1:2:7752432:7752534:-1:2:0:7751395:7751478:-1:0:0:7750811:7751021:-1:0:1:7749658:7749760:-1:1:2:7748906:7748997:-1:2:1:7747315:7748674:-1:1:-1',
  ENSPAGT00005011603 => ':7753278:7753492:-1:-1:1:7752773:7752881:-1:1:2:7752432:7752534:-1:2:0:7751395:7751478:-1:0:0:7750811:7751021:-1:0:1:7749658:7749760:-1:1:2:7748906:7748997:-1:2:1:7747315:7748674:-1:1:-1',
  ENSPAGT00005011612 => ':7753688:7754018:-1:-1:2:7753278:7753492:-1:2:1:7752773:7752881:-1:1:2:7752432:7752534:-1:2:0:7751395:7751478:-1:0:0:7750811:7751021:-1:0:1:7749658:7749760:-1:1:2:7748906:7748997:-1:2:1:7747315:7748674:-1:1:-1',
  ENSPAGT00005011665 => ':7518388:7518490:-1:0:1:7517269:7517542:-1:1:2:7516240:7516421:-1:2:1:7514938:7515035:-1:1:0:7513792:7513959:-1:0:0:7513142:7513260:-1:0:2:7512380:7512472:-1:2:2:7512206:7512248:-1:2:0',
  ENSPAGT00005011677 => ':7518685:7519565:-1:-1:1:7517269:7517542:-1:1:2:7516240:7516421:-1:2:1:7514938:7515035:-1:1:0:7513792:7513959:-1:0:0:7513142:7513260:-1:0:2:7512235:7512472:-1:2:-1',
  ENSPAGT00005011683 => ':7515542:7515703:-1:-1:-1:7514938:7515035:-1:-1:0:7513792:7513959:-1:0:0:7513142:7513260:-1:0:2:7512235:7512472:-1:2:-1',
  ENSPAGT00005012474 => ':10003198:10003204:-1:0:1:10002607:10002749:-1:1:0:10000811:10000973:-1:0:1:10000039:10000106:-1:1:0',
  ENSPAGT00005012947 => ':3625315:3625433:1:-1:0:3625984:3626065:1:0:1:3629744:3629782:1:1:1:3630261:3630361:1:1:0:3632765:3632931:1:0:-1',
  ENSPAGT00005013164 => ':15633807:15633999:-1:-1:2:15633453:15633550:-1:2:1:15632347:15632575:-1:1:2:15631680:15631837:-1:2:1:15630777:15630963:-1:1:2:15628789:15629536:-1:2:-1',
  ENSPAGT00005013176 => ':15633807:15633999:-1:-1:-1:15633453:15633550:-1:-1:-1:15631680:15631837:-1:-1:1:15630777:15630963:-1:1:2:15628789:15629536:-1:2:-1',
  ENSPAGT00005013186 => ':15633807:15633999:-1:-1:2:15633453:15633550:-1:2:1:15632347:15632575:-1:1:2:15631680:15631837:-1:2:1:15630777:15630963:-1:1:2:15629857:15630143:-1:2:-1',
  ENSPAGT00005013386 => ':10016089:10016924:-1:0:2:10015361:10015382:-1:2:0',
  ENSPAGT00005013388 => ':10016961:10017612:-1:-1:1:10015961:10016599:-1:1:-1',
  ENSPAGT00005016129 => ':7760205:7760316:-1:-1:-1:7759786:7760121:-1:-1:1:7758015:7758095:-1:1:1:7757819:7757926:-1:1:1:7756164:7756274:-1:1:1:7754885:7755435:-1:1:-1',
  ENSPAGT00005016139 => ':7760378:7760420:-1:0:1:7759744:7760115:-1:1:1:7758887:7758972:-1:1:0',
  ENSPAGT00005016260 => ':9996786:9999197:1:0:0:9999439:9999486:1:0:0',
  ENSPAGT00005017149 => ':13652489:13653941:1:-1:0:13654536:13654758:1:0:1:13654924:13655143:1:1:2:13655543:13656665:1:2:-1',
  ENSPAGT00005009955 => ':1190846:1192464:1:-1:0:1192791:1193002:1:0:2:1193142:1193318:1:2:2:1193398:1193651:1:2:-1',
  ENSPAGT00005009969 => ':1192432:1192464:1:0:0:1192791:1193002:1:0:2:1193142:1193278:1:2:1:1195155:1195345:1:1:0:1198082:1198288:1:0:0',
  ENSPAGT00005009973 => ':1194371:1194605:1:-1:0:1195184:1195345:1:0:0:1198082:1198328:1:0:-1',
  ENSPAGT00005008936 => ':1254816:1255038:1:-1:0:1279623:1281576:1:0:-1',
  ENSPAGT00005008942 => ':1254816:1255038:1:-1:0:1258699:1260865:1:0:-1',
  ENSPAGT00005008946 => ':1271232:1271449:1:-1:0:1279623:1281576:1:0:-1',
  ENSPAGT00005010439 => ':1557826:1557962:-1:-1:1:1556823:1557017:-1:1:1:1554164:1554334:-1:1:1:1553171:1553315:-1:1:2:1551975:1552594:-1:2:-1',
  ENSPAGT00005010460 => ':1631170:1631379:-1:0:0:1629977:1630079:-1:0:1:1579939:1580014:-1:1:2:1579218:1579324:-1:2:1:1576757:1576948:-1:1:1:1575540:1575716:-1:1:1:1573645:1573827:-1:1:1:1573103:1573282:-1:1:1:1572504:1572541:-1:1:0:1572389:1572419:-1:0:1:1572127:1572235:-1:1:2:1571624:1571793:-1:2:1:1571341:1571432:-1:1:0:1570961:1571073:-1:0:2:1570242:1570888:-1:2:1:1569232:1569372:-1:1:1:1568536:1568753:-1:1:0:1566928:1567039:-1:0:1:1565782:1565973:-1:1:1:1563277:1563421:-1:1:2:1562497:1562598:-1:2:2:1561348:1561466:-1:2:1:1560557:1560709:-1:1:1:1559652:1559807:-1:1:1:1557787:1557999:-1:1:1:1557712:1557747:-1:1:1:1556823:1556951:-1:1:1:1554164:1554334:-1:1:1:1553171:1553315:-1:1:2:1552300:1552594:-1:2:0',
  ENSPAGT00005010475 => ':1564776:1564904:-1:-1:-1:1563281:1563459:-1:-1:1:1562497:1562641:-1:1:2:1561348:1561466:-1:2:1:1560547:1560709:-1:1:2:1559652:1559812:-1:2:-1',
  ENSPAGT00005010485 => ':1563979:1564069:-1:-1:-1:1563281:1563459:-1:-1:1:1562497:1562641:-1:1:2:1561348:1561466:-1:2:1:1560547:1560709:-1:1:2:1559652:1559812:-1:2:-1',
  ENSPAGT00005010490 => ':1701669:1701838:-1:-1:1:1631170:1631327:-1:1:0:1629977:1630079:-1:0:1:1579939:1580014:-1:1:2:1579218:1579324:-1:2:1:1576757:1576948:-1:1:1:1575540:1575716:-1:1:1:1573690:1573827:-1:1:-1',
  ENSPAGT00005010496 => ':1701669:1701838:-1:-1:1:1631170:1631327:-1:1:0:1629977:1630079:-1:0:1:1579939:1580014:-1:1:2:1579218:1579324:-1:2:1:1576757:1576948:-1:1:1:1575540:1575716:-1:1:1:1574440:1574741:-1:1:-1',
  ENSPAGT00005008288 => ':2139403:2139745:1:-1:-1:2139895:2140688:1:-1:-1',
  ENSPAGT00005008308 => ':2139926:2140633:1:0:0:2144263:2144393:1:0:2:2145242:2145411:1:2:1:2146666:2146766:1:1:0:2147322:2147463:1:0:1:2148951:2149169:1:1:1:2149690:2149803:1:1:1:2155129:2155244:1:1:0:2155503:2155580:1:0:0',
  ENSPAGT00005008336 => ':2144728:2144912:1:-1:-1:2145232:2145411:1:-1:1:2146666:2146766:1:1:0:2147322:2147463:1:0:1:2148951:2149169:1:1:1:2149690:2149803:1:1:1:2155129:2155244:1:1:0:2155503:2155667:1:0:-1',
  ENSPAGT00005008352 => ':2144922:2145160:1:-1:1:2145232:2145411:1:1:1:2146666:2146766:1:1:0:2147322:2147463:1:0:1:2148951:2149169:1:1:1:2149690:2149803:1:1:1:2155129:2155244:1:1:0:2155503:2155667:1:0:-1',
  ENSPAGT00005012128 => ':2914577:2914704:1:-1:2:2921955:2922061:1:2:1:2922798:2922945:1:1:2:2925540:2925706:1:2:1:2926724:2926956:1:1:0',
  ENSPAGT00005012140 => ':2921521:2921581:1:0:1:2922038:2922061:1:1:1:2922798:2922945:1:1:2:2925540:2925706:1:2:1:2926724:2926984:1:1:1:2929605:2929693:1:1:0:2930511:2930669:1:0:0',
  ENSPAGT00005012154 => ':2930609:2930658:1:-1:1:2932193:2932356:1:1:0:2932653:2932805:1:0:0:2933314:2933405:1:0:2:2936516:2936643:1:2:-1',
  ENSPAGT00005011954 => ':13403734:13404112:-1:-1:-1:13402343:13402596:-1:-1:0:13401896:13402019:-1:0:1:13400961:13401211:-1:1:0:13400215:13400443:-1:0:1:13399324:13399690:-1:1:-1',
  ENSPAGT00005011959 => ':13402087:13402238:-1:-1:-1:13401896:13402019:-1:-1:1:13400961:13401211:-1:1:0:13400215:13400443:-1:0:1:13399324:13399690:-1:1:-1',
  ENSPAGT00005011967 => ':13412387:13413898:-1:0:0:13411320:13411484:-1:0:0:13409366:13409533:-1:0:0:13408615:13408644:-1:0:0:13402916:13403066:-1:0:1:13402349:13402596:-1:1:0:13401896:13402019:-1:0:1:13400961:13401211:-1:1:0:13400215:13400443:-1:0:1:13399485:13399690:-1:1:0',
  ENSPAGT00005011974 => ':13416493:13417891:-1:-1:0:13411320:13411484:-1:0:0:13409366:13409533:-1:0:0:13404268:13408644:-1:0:-1',
  ENSPAGT00005011976 => ':13412387:13414101:-1:-1:0:13409366:13409533:-1:0:0:13404268:13408644:-1:0:-1',
  ENSPAGT00005017980 => ':14122744:14122832:1:-1:1:14137108:14137165:1:1:2:14148555:14148622:1:2:1:14149144:14149235:1:1:0:14149722:14149813:1:0:2:14150343:14150494:1:2:1:14151415:14151505:1:1:2:14151702:14152122:1:2:0:14152663:14152798:1:0:1:14153335:14153454:1:1:1:14154353:14154529:1:1:1:14154664:14154808:1:1:2:14154928:14155076:1:2:1:14155509:14155674:1:1:2:14155858:14155994:1:2:1:14156477:14156629:1:1:1:14156800:14156890:1:1:2:14157177:14157259:1:2:1:14158030:14158164:1:1:1:14158927:14159079:1:1:1:14161925:14162054:1:1:2:14163160:14163344:1:2:1:14166146:14166340:1:1:1:14168399:14168599:1:1:1:14169678:14169838:1:1:0:14170815:14171007:1:0:1:14173289:14173406:1:1:2:14174856:14175010:1:2:1:14175617:14175730:1:1:1:14186301:14186378:1:1:1:14195003:14195511:1:1:-1',
  ENSPAGT00005018000 => ':14122744:14122832:1:-1:1:14137108:14137165:1:1:2:14148555:14148622:1:2:1:14149144:14149235:1:1:0:14149722:14149813:1:0:2:14150343:14150494:1:2:1:14151415:14151505:1:1:2:14151702:14152122:1:2:0:14152663:14152798:1:0:1:14153335:14153454:1:1:1:14154356:14154529:1:1:1:14154664:14154808:1:1:2:14154928:14155076:1:2:1:14155509:14155674:1:1:2:14155858:14155994:1:2:1:14156477:14156629:1:1:1:14156800:14156890:1:1:2:14157177:14157259:1:2:1:14158030:14158164:1:1:1:14158927:14159079:1:1:1:14161925:14162054:1:1:2:14163160:14163344:1:2:1:14164653:14164830:1:1:-1',
  ENSPAGT00005018029 => ':14166146:14166340:1:-1:1:14168399:14168599:1:1:1:14169678:14169838:1:1:0:14170815:14171007:1:0:1:14173289:14173406:1:1:2:14174856:14175010:1:2:1:14175617:14175730:1:1:1:14186301:14186378:1:1:1:14195003:14195511:1:1:-1',
);

my %transcript_coding_start = (
  ENSPAGT00005009094 => 7521145,
  ENSPAGT00005009105 => 7521145,
  ENSPAGT00005009363 => 13648692,
  ENSPAGT00005009369 => 13648692,
  ENSPAGT00005009377 => 13648250,
  ENSPAGT00005009805 => 15616727,
  ENSPAGT00005009808 => 15621141,
  ENSPAGT00005009856 => 10010727,
  ENSPAGT00005010431 => 3633997,
  ENSPAGT00005010435 => 3633997,
  ENSPAGT00005010440 => 3633997,
  ENSPAGT00005010941 => 9998455,
  ENSPAGT00005010944 => 9998455,
  ENSPAGT00005010947 => 9998455,
  ENSPAGT00005010952 => 9998455,
  ENSPAGT00005010958 => 9998455,
  ENSPAGT00005010980 => 3594201,
  ENSPAGT00005010995 => 3597442,
  ENSPAGT00005011019 => 3597442,
  ENSPAGT00005011035 => 3597442,
  ENSPAGT00005011166 => 10004907,
  ENSPAGT00005011173 => 10005559,
  ENSPAGT00005011597 => 7748577,
  ENSPAGT00005011603 => 7748577,
  ENSPAGT00005011612 => 7748577,
  ENSPAGT00005011665 => 7512206,
  ENSPAGT00005011677 => 7512307,
  ENSPAGT00005011683 => 7512307,
  ENSPAGT00005012474 => 10000039,
  ENSPAGT00005012947 => 3625389,
  ENSPAGT00005013164 => 15628990,
  ENSPAGT00005013176 => 15628990,
  ENSPAGT00005013186 => 15629858,
  ENSPAGT00005013386 => 10015361,
  ENSPAGT00005013388 => 10016013,
  ENSPAGT00005016129 => 7755326,
  ENSPAGT00005016139 => 7758887,
  ENSPAGT00005016260 => 9996786,
  ENSPAGT00005017149 => 13653117,
  ENSPAGT00005009955 => 1192390,
  ENSPAGT00005009969 => 1192432,
  ENSPAGT00005009973 => 1194603,
  ENSPAGT00005008936 => 1254982,
  ENSPAGT00005008942 => 1254982,
  ENSPAGT00005008946 => 1271393,
  ENSPAGT00005010439 => 1552300,
  ENSPAGT00005010460 => 1552300,
  ENSPAGT00005010475 => 1559653,
  ENSPAGT00005010485 => 1559653,
  ENSPAGT00005010490 => 1573691,
  ENSPAGT00005010496 => 1574719,
  ENSPAGT00005008288 => 2139926,
  ENSPAGT00005008308 => 2139926,
  ENSPAGT00005008336 => 2145372,
  ENSPAGT00005008352 => 2145088,
  ENSPAGT00005012128 => 2914676,
  ENSPAGT00005012140 => 2921521,
  ENSPAGT00005012154 => 2930652,
  ENSPAGT00005011954 => 13399485,
  ENSPAGT00005011959 => 13399485,
  ENSPAGT00005011967 => 13399485,
  ENSPAGT00005011974 => 13408549,
  ENSPAGT00005011976 => 13408549,
  ENSPAGT00005017980 => 14122781,
  ENSPAGT00005018000 => 14122781,
  ENSPAGT00005018029 => 14166325,
);

my %transcript_coding_end = (
  ENSPAGT00005009094 => 7539853,
  ENSPAGT00005009105 => 7539853,
  ENSPAGT00005009363 => 13651310,
  ENSPAGT00005009369 => 13651310,
  ENSPAGT00005009377 => 13651310,
  ENSPAGT00005009805 => 15623537,
  ENSPAGT00005009808 => 15628680,
  ENSPAGT00005009856 => 10024956,
  ENSPAGT00005010431 => 3636122,
  ENSPAGT00005010435 => 3636122,
  ENSPAGT00005010440 => 3636122,
  ENSPAGT00005010941 => 9998958,
  ENSPAGT00005010944 => 9998958,
  ENSPAGT00005010947 => 9998958,
  ENSPAGT00005010952 => 9998958,
  ENSPAGT00005010958 => 9998958,
  ENSPAGT00005010980 => 3616130,
  ENSPAGT00005010995 => 3616130,
  ENSPAGT00005011019 => 3617014,
  ENSPAGT00005011035 => 3615683,
  ENSPAGT00005011166 => 10006470,
  ENSPAGT00005011173 => 10006522,
  ENSPAGT00005011597 => 7753425,
  ENSPAGT00005011603 => 7753425,
  ENSPAGT00005011612 => 7753716,
  ENSPAGT00005011665 => 7518490,
  ENSPAGT00005011677 => 7518772,
  ENSPAGT00005011683 => 7514994,
  ENSPAGT00005012474 => 10003204,
  ENSPAGT00005012947 => 3632893,
  ENSPAGT00005013164 => 15633874,
  ENSPAGT00005013176 => 15631818,
  ENSPAGT00005013186 => 15633874,
  ENSPAGT00005013386 => 10016924,
  ENSPAGT00005013388 => 10016976,
  ENSPAGT00005016129 => 7760074,
  ENSPAGT00005016139 => 7760420,
  ENSPAGT00005016260 => 9999486,
  ENSPAGT00005017149 => 13655828,
  ENSPAGT00005009955 => 1193443,
  ENSPAGT00005009969 => 1198288,
  ENSPAGT00005009973 => 1198288,
  ENSPAGT00005008936 => 1280909,
  ENSPAGT00005008942 => 1259985,
  ENSPAGT00005008946 => 1280909,
  ENSPAGT00005010439 => 1557961,
  ENSPAGT00005010460 => 1631379,
  ENSPAGT00005010475 => 1563350,
  ENSPAGT00005010485 => 1563350,
  ENSPAGT00005010490 => 1701723,
  ENSPAGT00005010496 => 1701723,
  ENSPAGT00005008288 => 2140642,
  ENSPAGT00005008308 => 2155580,
  ENSPAGT00005008336 => 2155580,
  ENSPAGT00005008352 => 2155580,
  ENSPAGT00005012128 => 2926956,
  ENSPAGT00005012140 => 2930669,
  ENSPAGT00005012154 => 2936642,
  ENSPAGT00005011954 => 13402501,
  ENSPAGT00005011959 => 13401995,
  ENSPAGT00005011967 => 13413898,
  ENSPAGT00005011974 => 13417569,
  ENSPAGT00005011976 => 13413898,
  ENSPAGT00005017980 => 14195031,
  ENSPAGT00005018000 => 14164828,
  ENSPAGT00005018029 => 14195031,
);

my %transcripts_per_genes = (
  ENSPAGG00005004637 => 1,
  ENSPAGG00005004783 => 2,
  ENSPAGG00005005020 => 2,
  ENSPAGG00005005053 => 1,
  ENSPAGG00005005359 => 1,
  ENSPAGG00005005629 => 1,
  ENSPAGG00005005636 => 4,
  ENSPAGG00005005744 => 2,
  ENSPAGG00005005963 => 3,
  ENSPAGG00005006005 => 3,
  ENSPAGG00005006439 => 1,
  ENSPAGG00005006688 => 1,
  ENSPAGG00005006805 => 3,
  ENSPAGG00005006947 => 2,
  ENSPAGG00005008351 => 2,
  ENSPAGG00005008405 => 1,
  ENSPAGG00005008847 => 1,
  ENSPAGG00005005099 => 1,
  ENSPAGG00005004566 => 1,
# Expected value might be 6 when ENSPAGG00005005368 is fixed
  ENSPAGG00005005368 => 6,
  ENSPAGG00005004249 => 4,
  ENSPAGG00005006235 => 3,
  ENSPAGG00005008405 => 1,
  ENSPAGG00005005053 => 1,
  ENSPAGG00005006146 => 5,
  ENSPAGG00005009321 => 1,
  '14122744:14164830:1' => 1,
  '1194371:1198328:1' => 1,
  '1271232:1281576:1' => 1,
# The two genes below should be removed when ENSPAGG00005005368 is fixed
#  '1573690:1701838:-1' => 2,
#  '1551975:1557962:-1' => 1,
);

my $db = $multi->get_DBAdaptor('core');
my %target_db = (
  -dbname => $db->dbc->dbname,
  -host   => $db->dbc->host,
  -port   => $db->dbc->port,
  -user   => $db->dbc->user,
  -pass   => $db->dbc->pass,
  -driver => $db->dbc->driver,
);

standaloneJob(
	'Bio::EnsEMBL::Analysis::Hive::RunnableDB::CleanUTRs', # module
	{ # input param hash
    iid => $iid,
    source_db => \%target_db,
    suffix => 'test',
	},
  undef,
#  {
#    debug => 1,
#  },

);


my $genes = $db->get_GeneAdaptor->fetch_all;

cmp_ok(scalar(@$genes), '==', $expected_total_gene_count, 'Checking we stored all the genes');
my $transcripts_count = 0;
foreach my $gene (@$genes) {
  if ($gene->biotype eq 'protein_coding_test') {
    my $transcripts = $gene->get_all_Transcripts;
    my $gene_stable_id = $gene->stable_id || join(':', $gene->start, $gene->end, $gene->strand);
    cmp_ok(scalar(@$transcripts), '==', $transcripts_per_genes{$gene_stable_id}, "Checking the number of transcripts in $gene_stable_id");
    foreach my $transcript (@$transcripts) {
      my $stable_id = $transcript->stable_id;
      cmp_ok($transcript->coding_region_start, '==', $transcript_coding_start{$stable_id}, "Checking the genomic coding start $stable_id");
      cmp_ok($transcript->coding_region_end, '==', $transcript_coding_end{$stable_id}, "Checking the genomic coding end $stable_id");
      my $id;
      foreach my $exon (@{$transcript->get_all_Exons}) {
        $id .= ':'.join(':', $exon->start, $exon->end, $exon->strand, $exon->phase, $exon->end_phase);
      }
      cmp_ok($id, 'eq', $transcript_hashkey{$stable_id}, "Checking transcript structure for $stable_id");
      ++$transcripts_count;
    }
  }
}
cmp_ok($transcripts_count, '==', $expected_total_transcript_count, 'We stored all the transcripts');

done_testing();
